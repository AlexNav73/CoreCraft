
//------------------------------------------------------------------------------
// <auto-generated>
//     This code was generated by the tool.
//
//     Changes to this file may cause incorrect behavior and will be lost if
//     the code is regenerated.
// </auto-generated>
//------------------------------------------------------------------------------

#nullable enable

namespace compilation.AnotherModelFile
{
    using Navitski.Crystalized.Model.Engine;
    using Navitski.Crystalized.Model.Engine.Core;
    using Navitski.Crystalized.Model.Engine.ChangesTracking;
    using Navitski.Crystalized.Model.Engine.Lazy;
    using Navitski.Crystalized.Model.Engine.Persistence;
    using compilation.AnotherModelFile.Entities;

    [global::System.CodeDom.Compiler.GeneratedCodeAttribute("C# Source Generator", "1.0.0.0")]
    [global::System.Runtime.CompilerServices.CompilerGeneratedAttribute()]
    internal interface IFakeModelShard : IModelShard
    {
        ICollection<FirstEntity, FirstEntityProperties> FirstCollection { get; }
        ICollection<SecondEntity, SecondEntityProperties> SecondCollection { get; }

        IRelation<FirstEntity, SecondEntity> OneToOneRelation { get; }
        IRelation<FirstEntity, SecondEntity> OneToManyRelation { get; }
        IRelation<FirstEntity, SecondEntity> ManyToOneRelation { get; }
        IRelation<FirstEntity, SecondEntity> ManyToManyRelation { get; }
    }

    [global::System.CodeDom.Compiler.GeneratedCodeAttribute("C# Source Generator", "1.0.0.0")]
    [global::System.Runtime.CompilerServices.CompilerGeneratedAttribute()]
    internal interface IMutableFakeModelShard : IModelShard
    {
        IMutableCollection<FirstEntity, FirstEntityProperties> FirstCollection { get; }
        IMutableCollection<SecondEntity, SecondEntityProperties> SecondCollection { get; }

        IMutableRelation<FirstEntity, SecondEntity> OneToOneRelation { get; }
        IMutableRelation<FirstEntity, SecondEntity> OneToManyRelation { get; }
        IMutableRelation<FirstEntity, SecondEntity> ManyToOneRelation { get; }
        IMutableRelation<FirstEntity, SecondEntity> ManyToManyRelation { get; }
    }

    [global::System.CodeDom.Compiler.GeneratedCodeAttribute("C# Source Generator", "1.0.0.0")]
    [global::System.Runtime.CompilerServices.CompilerGeneratedAttribute()]
    [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
    [global::System.Diagnostics.CodeAnalysis.ExcludeFromCodeCoverageAttribute()]
    internal sealed partial class FakeModelShard : IFakeModelShard
    {
        [global::System.Diagnostics.CodeAnalysis.SetsRequiredMembersAttribute()]
        public FakeModelShard()
        {
            FirstCollection = new Collection<FirstEntity, FirstEntityProperties>(id => new FirstEntity(id), () => new FirstEntityProperties());
            SecondCollection = new Collection<SecondEntity, SecondEntityProperties>(id => new SecondEntity(id), () => new SecondEntityProperties());

            OneToOneRelation = new Relation<FirstEntity, SecondEntity>(new OneToOne<FirstEntity, SecondEntity>(), new OneToOne<SecondEntity, FirstEntity>());
            OneToManyRelation = new Relation<FirstEntity, SecondEntity>(new OneToMany<FirstEntity, SecondEntity>(), new OneToOne<SecondEntity, FirstEntity>());
            ManyToOneRelation = new Relation<FirstEntity, SecondEntity>(new OneToOne<FirstEntity, SecondEntity>(), new OneToMany<SecondEntity, FirstEntity>());
            ManyToManyRelation = new Relation<FirstEntity, SecondEntity>(new OneToMany<FirstEntity, SecondEntity>(), new OneToMany<SecondEntity, FirstEntity>());
        }

        public required ICollection<FirstEntity, FirstEntityProperties> FirstCollection { get; init; }
        public required ICollection<SecondEntity, SecondEntityProperties> SecondCollection { get; init; }

        public required IRelation<FirstEntity, SecondEntity> OneToOneRelation { get; init; }
        public required IRelation<FirstEntity, SecondEntity> OneToManyRelation { get; init; }
        public required IRelation<FirstEntity, SecondEntity> ManyToOneRelation { get; init; }
        public required IRelation<FirstEntity, SecondEntity> ManyToManyRelation { get; init; }
    }

    internal sealed partial class FakeModelShard : ICanBeMutable<IMutableFakeModelShard>
    {
        public IMutableFakeModelShard AsMutable(Features features, IWritableModelChanges modelChanges)
        {
            IMutableCollection<FirstEntity, FirstEntityProperties> firstCollection = new CoWCollection<FirstEntity, FirstEntityProperties>(FirstCollection);
            IMutableCollection<SecondEntity, SecondEntityProperties> secondCollection = new CoWCollection<SecondEntity, SecondEntityProperties>(SecondCollection);

            IMutableRelation<FirstEntity, SecondEntity> oneToOneRelation = new CoWRelation<FirstEntity, SecondEntity>(OneToOneRelation);
            IMutableRelation<FirstEntity, SecondEntity> oneToManyRelation = new CoWRelation<FirstEntity, SecondEntity>(OneToManyRelation);
            IMutableRelation<FirstEntity, SecondEntity> manyToOneRelation = new CoWRelation<FirstEntity, SecondEntity>(ManyToOneRelation);
            IMutableRelation<FirstEntity, SecondEntity> manyToManyRelation = new CoWRelation<FirstEntity, SecondEntity>(ManyToManyRelation);

            if ((features & Features.Track) == Features.Track)
            {
                var frame = modelChanges.Register(new FakeChangesFrame());

                firstCollection = new TrackableCollection<FirstEntity, FirstEntityProperties>(frame.FirstCollection, firstCollection);
                secondCollection = new TrackableCollection<SecondEntity, SecondEntityProperties>(frame.SecondCollection, secondCollection);

                oneToOneRelation = new TrackableRelation<FirstEntity, SecondEntity>(frame.OneToOneRelation, oneToOneRelation);
                oneToManyRelation = new TrackableRelation<FirstEntity, SecondEntity>(frame.OneToManyRelation, oneToManyRelation);
                manyToOneRelation = new TrackableRelation<FirstEntity, SecondEntity>(frame.ManyToOneRelation, manyToOneRelation);
                manyToManyRelation = new TrackableRelation<FirstEntity, SecondEntity>(frame.ManyToManyRelation, manyToManyRelation);
            }

            return new MutableFakeModelShard()
            {
                FirstCollection = firstCollection,
                SecondCollection = secondCollection,

                OneToOneRelation = oneToOneRelation,
                OneToManyRelation = oneToManyRelation,
                ManyToOneRelation = manyToOneRelation,
                ManyToManyRelation = manyToManyRelation,
            };
        }
    }

    [global::System.CodeDom.Compiler.GeneratedCodeAttribute("C# Source Generator", "1.0.0.0")]
    [global::System.Runtime.CompilerServices.CompilerGeneratedAttribute()]
    internal interface IFakeChangesFrame : IChangesFrame
    {
        ICollectionChangeSet<FirstEntity, FirstEntityProperties> FirstCollection { get; }
        ICollectionChangeSet<SecondEntity, SecondEntityProperties> SecondCollection { get; }

        IRelationChangeSet<FirstEntity, SecondEntity> OneToOneRelation { get; }
        IRelationChangeSet<FirstEntity, SecondEntity> OneToManyRelation { get; }
        IRelationChangeSet<FirstEntity, SecondEntity> ManyToOneRelation { get; }
        IRelationChangeSet<FirstEntity, SecondEntity> ManyToManyRelation { get; }
    }

    [global::System.CodeDom.Compiler.GeneratedCodeAttribute("C# Source Generator", "1.0.0.0")]
    [global::System.Runtime.CompilerServices.CompilerGeneratedAttribute()]
    [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
    [global::System.Diagnostics.CodeAnalysis.ExcludeFromCodeCoverageAttribute()]
    internal sealed class FakeChangesFrame : IFakeChangesFrame, IWritableChangesFrame
    {
        public FakeChangesFrame()
        {
            FirstCollection = new CollectionChangeSet<FirstEntity, FirstEntityProperties>();
            SecondCollection = new CollectionChangeSet<SecondEntity, SecondEntityProperties>();

            OneToOneRelation = new RelationChangeSet<FirstEntity, SecondEntity>();
            OneToManyRelation = new RelationChangeSet<FirstEntity, SecondEntity>();
            ManyToOneRelation = new RelationChangeSet<FirstEntity, SecondEntity>();
            ManyToManyRelation = new RelationChangeSet<FirstEntity, SecondEntity>();
        }

        public ICollectionChangeSet<FirstEntity, FirstEntityProperties> FirstCollection { get; private set; }
        public ICollectionChangeSet<SecondEntity, SecondEntityProperties> SecondCollection { get; private set; }

        public IRelationChangeSet<FirstEntity, SecondEntity> OneToOneRelation { get; private set; }
        public IRelationChangeSet<FirstEntity, SecondEntity> OneToManyRelation { get; private set; }
        public IRelationChangeSet<FirstEntity, SecondEntity> ManyToOneRelation { get; private set; }
        public IRelationChangeSet<FirstEntity, SecondEntity> ManyToManyRelation { get; private set; }

        public IWritableChangesFrame Invert()
        {
            return new FakeChangesFrame()
            {
                FirstCollection = FirstCollection.Invert(),
                SecondCollection = SecondCollection.Invert(),

                OneToOneRelation = OneToOneRelation.Invert(),
                OneToManyRelation = OneToManyRelation.Invert(),
                ManyToOneRelation = ManyToOneRelation.Invert(),
                ManyToManyRelation = ManyToManyRelation.Invert(),
            };
        }

        public void Apply(IModel model)
        {
            var modelShard = model.Shard<IMutableFakeModelShard>();

            OneToOneRelation.Apply(modelShard.OneToOneRelation);
            OneToManyRelation.Apply(modelShard.OneToManyRelation);
            ManyToOneRelation.Apply(modelShard.ManyToOneRelation);
            ManyToManyRelation.Apply(modelShard.ManyToManyRelation);
            FirstCollection.Apply(modelShard.FirstCollection);
            SecondCollection.Apply(modelShard.SecondCollection);
        }

        public bool HasChanges()
        {
            return FirstCollection.HasChanges() || SecondCollection.HasChanges() || OneToOneRelation.HasChanges() || OneToManyRelation.HasChanges() || ManyToOneRelation.HasChanges() || ManyToManyRelation.HasChanges();
        }

        public IWritableChangesFrame Merge(IChangesFrame frame)
        {
            var typedFrame = (FakeChangesFrame)frame;

            return new FakeChangesFrame()
            {
                FirstCollection = FirstCollection.Merge(typedFrame.FirstCollection),
                SecondCollection = SecondCollection.Merge(typedFrame.SecondCollection),

                OneToOneRelation = OneToOneRelation.Merge(typedFrame.OneToOneRelation),
                OneToManyRelation = OneToManyRelation.Merge(typedFrame.OneToManyRelation),
                ManyToOneRelation = ManyToOneRelation.Merge(typedFrame.ManyToOneRelation),
                ManyToManyRelation = ManyToManyRelation.Merge(typedFrame.ManyToManyRelation),
            };
        }
    }

    [global::System.CodeDom.Compiler.GeneratedCodeAttribute("C# Source Generator", "1.0.0.0")]
    [global::System.Runtime.CompilerServices.CompilerGeneratedAttribute()]
    [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
    [global::System.Diagnostics.CodeAnalysis.ExcludeFromCodeCoverageAttribute()]
    internal sealed class MutableFakeModelShard : IMutableFakeModelShard, ICanBeReadOnly<IFakeModelShard>
    {
        public required IMutableCollection<FirstEntity, FirstEntityProperties> FirstCollection { get; init; }
        public required IMutableCollection<SecondEntity, SecondEntityProperties> SecondCollection { get; init; }

        public required IMutableRelation<FirstEntity, SecondEntity> OneToOneRelation { get; init; }
        public required IMutableRelation<FirstEntity, SecondEntity> OneToManyRelation { get; init; }
        public required IMutableRelation<FirstEntity, SecondEntity> ManyToOneRelation { get; init; }
        public required IMutableRelation<FirstEntity, SecondEntity> ManyToManyRelation { get; init; }

        public IFakeModelShard AsReadOnly()
        {
            return new FakeModelShard()
            {
                FirstCollection = ((ICanBeReadOnly<ICollection<FirstEntity, FirstEntityProperties>>)FirstCollection).AsReadOnly(),
                SecondCollection = ((ICanBeReadOnly<ICollection<SecondEntity, SecondEntityProperties>>)SecondCollection).AsReadOnly(),

                OneToOneRelation = ((ICanBeReadOnly<IRelation<FirstEntity, SecondEntity>>)OneToOneRelation).AsReadOnly(),
                OneToManyRelation = ((ICanBeReadOnly<IRelation<FirstEntity, SecondEntity>>)OneToManyRelation).AsReadOnly(),
                ManyToOneRelation = ((ICanBeReadOnly<IRelation<FirstEntity, SecondEntity>>)ManyToOneRelation).AsReadOnly(),
                ManyToManyRelation = ((ICanBeReadOnly<IRelation<FirstEntity, SecondEntity>>)ManyToManyRelation).AsReadOnly(),
            };
        }
    }

    [global::System.CodeDom.Compiler.GeneratedCodeAttribute("C# Source Generator", "1.0.0.0")]
    [global::System.Runtime.CompilerServices.CompilerGeneratedAttribute()]
    [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
    [global::System.Diagnostics.CodeAnalysis.ExcludeFromCodeCoverageAttribute()]
    internal sealed class FakeModelShardStorage : ModelShardStorage
    {
        internal static readonly CollectionInfo FirstCollectionInfo = new("Fake", "FirstCollection", new Property[] { new("NonNullableStringProperty", typeof(string), false), new("NullableStringProperty", typeof(string), true), new("NullableStringWithDefaultValueProperty", typeof(string), true) });
        internal static readonly CollectionInfo SecondCollectionInfo = new("Fake", "SecondCollection", new Property[] { new("IntProperty", typeof(int), false), new("BoolProperty", typeof(bool), false), new("DoubleProperty", typeof(double), false), new("FloatProperty", typeof(float), false) });

        internal static readonly RelationInfo OneToOneRelationInfo = new("Fake", "OneToOneRelation");
        internal static readonly RelationInfo OneToManyRelationInfo = new("Fake", "OneToManyRelation");
        internal static readonly RelationInfo ManyToOneRelationInfo = new("Fake", "ManyToOneRelation");
        internal static readonly RelationInfo ManyToManyRelationInfo = new("Fake", "ManyToManyRelation");

        public override void Update(IRepository repository, IModelChanges changes)
        {
            if (changes.TryGetFrame<IFakeChangesFrame>(out var frame))
            {
                Update(repository, FirstCollectionInfo, frame.FirstCollection);
                Update(repository, SecondCollectionInfo, frame.SecondCollection);

                Update(repository, OneToOneRelationInfo, frame.OneToOneRelation);
                Update(repository, OneToManyRelationInfo, frame.OneToManyRelation);
                Update(repository, ManyToOneRelationInfo, frame.ManyToOneRelation);
                Update(repository, ManyToManyRelationInfo, frame.ManyToManyRelation);
            }
        }

        public override void Save(IRepository repository, IModel model)
        {
            var shard = model.Shard<IFakeModelShard>();

            Save(repository, FirstCollectionInfo, shard.FirstCollection);
            Save(repository, SecondCollectionInfo, shard.SecondCollection);

            Save(repository, OneToOneRelationInfo, shard.OneToOneRelation);
            Save(repository, OneToManyRelationInfo, shard.OneToManyRelation);
            Save(repository, ManyToOneRelationInfo, shard.ManyToOneRelation);
            Save(repository, ManyToManyRelationInfo, shard.ManyToManyRelation);
        }

        public override void Load(IRepository repository, IModel model)
        {
            var shard = model.Shard<IMutableFakeModelShard>();

            Load(repository, FirstCollectionInfo, shard.FirstCollection);
            Load(repository, SecondCollectionInfo, shard.SecondCollection);

            Load(repository, OneToOneRelationInfo, shard.OneToOneRelation, shard.FirstCollection, shard.SecondCollection);
            Load(repository, OneToManyRelationInfo, shard.OneToManyRelation, shard.FirstCollection, shard.SecondCollection);
            Load(repository, ManyToOneRelationInfo, shard.ManyToOneRelation, shard.FirstCollection, shard.SecondCollection);
            Load(repository, ManyToManyRelationInfo, shard.ManyToManyRelation, shard.FirstCollection, shard.SecondCollection);
        }
    }

}

namespace compilation.AnotherModelFile.Entities
{
    using Navitski.Crystalized.Model.Engine.Core;

    [global::System.CodeDom.Compiler.GeneratedCodeAttribute("C# Source Generator", "1.0.0.0")]
    [global::System.Runtime.CompilerServices.CompilerGeneratedAttribute()]
    [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
    [global::System.Diagnostics.CodeAnalysis.ExcludeFromCodeCoverageAttribute()]
    public sealed record FirstEntity(global::System.Guid Id) : Entity(Id)
    {
        internal FirstEntity() : this(global::System.Guid.NewGuid())
        {
        }
    }

    [global::System.CodeDom.Compiler.GeneratedCodeAttribute("C# Source Generator", "1.0.0.0")]
    [global::System.Runtime.CompilerServices.CompilerGeneratedAttribute()]
    [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
    [global::System.Diagnostics.CodeAnalysis.ExcludeFromCodeCoverageAttribute()]
    public sealed partial record FirstEntityProperties : Properties
    {
        public FirstEntityProperties()
        {
            NonNullableStringProperty = string.Empty;
        }

        public string NonNullableStringProperty { get; init; }
        public string? NullableStringProperty { get; init; }
        public string? NullableStringWithDefaultValueProperty { get; init; }

#if NET5_0_OR_GREATER
        public override FirstEntityProperties ReadFrom(IPropertiesBag bag)
#else
        public override Properties ReadFrom(IPropertiesBag bag)
#endif
        {
            return new FirstEntityProperties()
            {
                NonNullableStringProperty = bag.Read<string>("NonNullableStringProperty"),
                NullableStringProperty = bag.Read<string>("NullableStringProperty"),
                NullableStringWithDefaultValueProperty = bag.Read<string>("NullableStringWithDefaultValueProperty"),
            };
        }

        public override void WriteTo(IPropertiesBag bag)
        {
            bag.Write("NonNullableStringProperty", NonNullableStringProperty);
            bag.Write("NullableStringProperty", NullableStringProperty);
            bag.Write("NullableStringWithDefaultValueProperty", NullableStringWithDefaultValueProperty);
        }

    }

    [global::System.CodeDom.Compiler.GeneratedCodeAttribute("C# Source Generator", "1.0.0.0")]
    [global::System.Runtime.CompilerServices.CompilerGeneratedAttribute()]
    [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
    [global::System.Diagnostics.CodeAnalysis.ExcludeFromCodeCoverageAttribute()]
    public sealed record SecondEntity(global::System.Guid Id) : Entity(Id)
    {
        internal SecondEntity() : this(global::System.Guid.NewGuid())
        {
        }
    }

    [global::System.CodeDom.Compiler.GeneratedCodeAttribute("C# Source Generator", "1.0.0.0")]
    [global::System.Runtime.CompilerServices.CompilerGeneratedAttribute()]
    [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
    [global::System.Diagnostics.CodeAnalysis.ExcludeFromCodeCoverageAttribute()]
    public sealed partial record SecondEntityProperties : Properties
    {
        public SecondEntityProperties()
        {
        }

        public int IntProperty { get; init; }
        public bool BoolProperty { get; init; }
        public double DoubleProperty { get; init; }
        public float FloatProperty { get; init; }

#if NET5_0_OR_GREATER
        public override SecondEntityProperties ReadFrom(IPropertiesBag bag)
#else
        public override Properties ReadFrom(IPropertiesBag bag)
#endif
        {
            return new SecondEntityProperties()
            {
                IntProperty = bag.Read<int>("IntProperty"),
                BoolProperty = bag.Read<bool>("BoolProperty"),
                DoubleProperty = bag.Read<double>("DoubleProperty"),
                FloatProperty = bag.Read<float>("FloatProperty"),
            };
        }

        public override void WriteTo(IPropertiesBag bag)
        {
            bag.Write("IntProperty", IntProperty);
            bag.Write("BoolProperty", BoolProperty);
            bag.Write("DoubleProperty", DoubleProperty);
            bag.Write("FloatProperty", FloatProperty);
        }

    }


}
